steps:
- checkout: DeploytoAKS
- task: Docker@0
  displayName: 'Build an image'
  inputs:
    azureSubscription: 'Vignesh-Service-Connection'
    azureContainerRegistry: '{"loginServer":"vigneshwardevops.azurecr.io", "id" : "/subscriptions/23d9e783-b881-49e7-b2f1-a1a6f1bc2d90/resourceGroups/Vigneshwar-RG/providers/Microsoft.ContainerRegistry/registries/VigneshwarDevops"}'
    dockerFile: app/Dockerfile

- task: Docker@0
  displayName: 'Push an image'
  inputs:
    azureSubscription: 'Vignesh-Service-Connection'
    azureContainerRegistry: '{"loginServer":"vigneshwardevops.azurecr.io", "id" : "/subscriptions/23d9e783-b881-49e7-b2f1-a1a6f1bc2d90/resourceGroups/Vigneshwar-RG/providers/Microsoft.ContainerRegistry/registries/VigneshwarDevops"}'
    action: 'Push an image'

- task: CopyFiles@2
  displayName: 'Copy Files to: $(build.artifactstagingdirectory)'
  inputs:
    SourceFolder: app
    TargetFolder: '$(build.artifactstagingdirectory)'

- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: Docker File and MVC Code'
  inputs:
    ArtifactName: 'Docker File and MVC Code'

